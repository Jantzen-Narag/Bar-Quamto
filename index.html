<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bar Quamto Q&A</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
      transition: background 0.3s, color 0.3s;
    }

    body.day {
      background: #f4f6f9;
      color: #222;
    }

    body.night {
      background: rgb(142, 142, 147);
      color: #f9f9f9;
    }

    h1 {
      margin-bottom: 5px;
      font-size: 36px;
    }

    #counter {
      margin-bottom: 20px;
      font-size: 18px;
      color: inherit;
    }

    #timer {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #1e88e5;
      color: white;
      padding: 10px 16px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 900px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      text-align: justify;
      white-space: pre-wrap;
      transition: background 0.3s, color 0.3s;
    }

    body.night .card {
      background: #2c2c2e;
      color: #f9f9f9;
    }

    #question {
      margin-bottom: 30px;
    }

    #answer {
      display: none;
      color: #2e7d32;
    }

    body.night #answer {
      color: #7cff7c;
    }

    .button-row {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
    }

    button, select {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #1565c0;
    }

    .controls {
      margin-top: 25px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }

    label {
      font-size: 14px;
      margin-right: 6px;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 28px;
      }

      .controls, .button-row {
        flex-direction: column;
        gap: 15px;
      }
    }
  </style>
</head>
<body class="day">

<div id="timer">⏳ 12:00</div>
<h1>Bar Quamto Random Q&A</h1>
<div id="counter">Loading questions...</div>

<div id="question" class="card" style="font-size:32px;">Press "Generate" to start</div>
<div id="answer" class="card" style="font-size:32px;"></div>

<div class="button-row">
  <button onclick="generateQA()">Generate</button>
  <button onclick="toggleAnswer()">Show/Hide Answer</button>
</div>

<div class="controls">
  <div>
    <label for="fontSize">Font Size:</label>
    <select id="fontSize" onchange="updateFontSize(this.value)">
      <option value="24">24px</option>
      <option value="28">28px</option>
      <option value="32" selected>32px</option>
      <option value="36">36px</option>
      <option value="40">40px</option>
      <option value="48">48px</option>
    </select>
  </div>

  <div>
    <label for="modeToggle">Mode:</label>
    <select id="modeToggle" onchange="toggleMode(this.value)">
      <option value="day" selected>Day</option>
      <option value="night">Night</option>
    </select>
  </div>
</div>

<script>
const sheetID = '1Ga6gDNCJqlIRhawqiqw_vaNZ_W4maxv2OS_km6yGDMw';
const sheetURL = `https://docs.google.com/spreadsheets/d/1Ga6gDNCJqlIRhawqiqw_vaNZ_W4maxv2OS_km6yGDMw/gviz/tq?tqx=out:json`;

let allData = [];
let usedIndices = new Set();
let timerInterval = null;

async function fetchSheetData() {
  try {
    const res = await fetch(sheetURL);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    allData = rows.map(r => ({
      question: r.c[0]?.v || '',
      answer: r.c[1]?.v || ''
    })).filter(q => q.question && q.answer);

    document.getElementById('counter').textContent =
      `Questions remaining: ${allData.length} of ${allData.length}`;

  } catch (e) {
    alert("Failed to load Google Sheet.");
    console.error(e);
  }
}

function generateQA() {
  if (allData.length === 0) {
    alert("Data not yet loaded.");
    return;
  }

  if (usedIndices.size >= allData.length) {
    alert("All questions used! Resetting...");
    usedIndices.clear();
  }

  let index;
  do {
    index = Math.floor(Math.random() * allData.length);
  } while (usedIndices.has(index));
  usedIndices.add(index);

  const item = allData[index];
  document.getElementById('question').textContent = item.question;
  document.getElementById('answer').textContent = item.answer;
  document.getElementById('answer').style.display = 'none';

  document.getElementById('counter').textContent =
    `Questions remaining: ${allData.length - usedIndices.size} of ${allData.length}`;

  startTimer(12 * 60);
}

function toggleAnswer() {
  const answer = document.getElementById('answer');
  answer.style.display = (answer.style.display === 'none') ? 'block' : 'none';
}

function startTimer(seconds) {
  clearInterval(timerInterval);
  const timer = document.getElementById('timer');
  let remaining = seconds;

  function update() {
    const m = String(Math.floor(remaining / 60)).padStart(2, '0');
    const s = String(remaining % 60).padStart(2, '0');
    timer.textContent = `⏳ ${m}:${s}`;
    if (remaining <= 0) clearInterval(timerInterval);
    remaining--;
  }

  update();
  timerInterval = setInterval(update, 1000);
}

function updateFontSize(size) {
  document.getElementById('question').style.fontSize = size + 'px';
  document.getElementById('answer').style.fontSize = size + 'px';
}

function toggleMode(mode) {
  document.body.className = mode;
}

window.onload = fetchSheetData;
</script>

</body>
</html>
