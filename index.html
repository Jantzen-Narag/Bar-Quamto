<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bar Quamto Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: #fff;
      color: #000;
      transition: background-color 0.3s, color 0.3s;
    }
    body.night {
      background-color: rgb(142, 142, 147);
      color: #fff;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .top-controls {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .subject-block {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    #question {
      font-size: 32px;
      text-align: justify;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
      margin-top: 1rem;
    }
    #answer-container {
      display: none;
      gap: 2rem;
      margin-top: 1rem;
    }
    #answer, #user-input {
      flex: 1;
      font-size: 32px;
      text-align: justify;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    textarea {
      width: 100%;
      resize: vertical;
      min-height: 100px;
      font-size: 32px;
    }
    .controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1rem;
    }
    .button {
      padding: 0.75rem 1.5rem;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #007BFF;
      color: white;
    }
    .info-text {
      margin-top: 1rem;
      font-style: italic;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="top-controls">
      <label for="font-size">Font Size:</label>
      <select id="font-size">
        <option value="24">24</option>
        <option value="28">28</option>
        <option value="32" selected>32</option>
        <option value="36">36</option>
      </select>
      <button id="theme-toggle">ðŸŒ—</button>
      <span id="timer">12:00</span>
    </div>
    <div class="subject-block">
      <label for="subject-select">Subject:</label>
      <select id="subject-select">
        <option value="Any">Any</option>
        <option>Political and International Law</option>
        <option>Labor Law and Social Legislation</option>
        <option>Civil Law</option>
        <option>Taxation</option>
        <option>Mercantile Law</option>
        <option>Criminal Law</option>
        <option>Remedial Law</option>
        <option>Legal and Judicial Ethics</option>
      </select>
    </div>
  </div>

  <div id="remaining"></div>
  <button class="button" id="generate">Generate Question</button>

  <div id="question"></div>
  <div id="subject-info" class="info-text"></div>

  <div id="answer-container" style="display: none; flex-direction: row;">
    <div id="answer"></div>
    <div id="user-input">
      <label for="userAnswer">Your Answer:</label>
      <textarea id="userAnswer" placeholder="Type your answer here..."></textarea>
    </div>
  </div>

  <div class="controls">
    <button class="button" id="toggle-answer">Show/Hide Answer</button>
  </div>

  <script>
    const sheetID = '1Ga6gDNCJqlIRhawqiqw_vaNZ_W4maxv2OS_km6yGDMw';
    const sheetURL = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json`;
    let data = [], usedIndexes = [], timerInterval;

    const fetchSheet = async () => {
      try {
        const res = await fetch(sheetURL);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;
        data = rows.map(r => ({
          question: r.c[0]?.v || '',
          answer: r.c[1]?.v || '',
          subject: r.c[2]?.v || 'Unknown'
        })).filter(q => q.question && q.answer);
        document.getElementById("remaining").textContent = `${data.length - usedIndexes.length} Questions Remaining`;
      } catch (e) {
        alert("Failed to load Google Sheet.");
        console.error(e);
      }
    };

    const getSelectedSubject = () => document.getElementById("subject-select").value;

    const generateQuestion = () => {
      const subject = getSelectedSubject();
      let filtered = subject === "Any" ? data : data.filter(q => q.subject === subject);
      const remaining = filtered.filter((_, i) => !usedIndexes.includes(data.indexOf(_)));
      if (remaining.length === 0) {
        document.getElementById("question").textContent = `No Question under ${subject} Subject Yet. Still being encoded.`;
        document.getElementById("answer").textContent = '';
        document.getElementById("subject-info").textContent = '';
        return;
      }
      const randomIndex = Math.floor(Math.random() * remaining.length);
      const item = remaining[randomIndex];
      const originalIndex = data.indexOf(item);
      usedIndexes.push(originalIndex);

      document.getElementById("question").textContent = item.question;
      document.getElementById("answer").textContent = item.answer;
      document.getElementById("subject-info").textContent = subject === "Any" ? `Question on ${item.subject} Subject` : '';

      document.getElementById("answer-container").style.display = "none";
      document.getElementById("userAnswer").value = "";
      document.getElementById("remaining").textContent = `${data.length - usedIndexes.length} Questions Remaining`;

      startTimer();
    };

    const startTimer = () => {
      clearInterval(timerInterval);
      let time = 12 * 60;
      timerInterval = setInterval(() => {
        const min = Math.floor(time / 60).toString().padStart(2, '0');
        const sec = (time % 60).toString().padStart(2, '0');
        document.getElementById("timer").textContent = `${min}:${sec}`;
        time--;
        if (time < 0) clearInterval(timerInterval);
      }, 1000);
    };

    document.getElementById("font-size").addEventListener("change", e => {
      const size = e.target.value + "px";
      document.getElementById("question").style.fontSize = size;
      document.getElementById("answer").style.fontSize = size;
      document.getElementById("user-input").style.fontSize = size;
    });

    document.getElementById("theme-toggle").addEventListener("click", () => {
      document.body.classList.toggle("night");
    });

    document.getElementById("generate").addEventListener("click", generateQuestion);
    document.getElementById("toggle-answer").addEventListener("click", () => {
      const container = document.getElementById("answer-container");
      container.style.display = container.style.display === "none" ? "flex" : "none";
    });

    fetchSheet();
  </script>
</body>
</html>
