<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Bar Quamto Q&A</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    h1 {
      margin-bottom: 10px;
      font-size: 36px;
      color: #333;
    }

    #counter {
      margin-bottom: 20px;
      font-size: 20px;
      color: #444;
    }

    #timer {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #1e88e5;
      color: white;
      padding: 10px 16px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 900px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      text-align: justify;
      font-size: 32px;
      line-height: 1.6;
      white-space: pre-wrap;
    }

    #question {
      margin-bottom: 30px;
    }

    #answer {
      display: none;
      color: #2e7d32;
    }

    .button-row {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 40px;
    }

    button {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 14px 28px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #1565c0;
    }

    @media (max-width: 600px) {
      .card {
        font-size: 24px;
        padding: 20px;
      }

      h1 {
        font-size: 28px;
      }

      .button-row {
        flex-direction: column;
        gap: 16px;
      }
    }
  </style>
</head>
<body>

<div id="timer">⏳ 12:00</div>
<h1>Bar Quamto Random Q&A</h1>
<div id="counter">Loading questions...</div>

<div id="question" class="card">Press "Generate" to start</div>
<div id="answer" class="card"></div>

<div class="button-row">
  <button onclick="generateQA()">Generate</button>
  <button onclick="toggleAnswer()">Show/Hide Answer</button>
</div>

<script>
const sheetID = '1Ga6gDNCJqlIRhawqiqw_vaNZ_W4maxv2OS_km6yGDMw';
const sheetURL = `https://docs.google.com/spreadsheets/d/1Ga6gDNCJqlIRhawqiqw_vaNZ_W4maxv2OS_km6yGDMw/gviz/tq?tqx=out:json`;

let allData = [];
let usedIndices = new Set();
let timerInterval;

async function fetchSheetData() {
  try {
    const res = await fetch(sheetURL);
    const text = await res.text();
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    allData = rows.map(r => ({
      question: r.c[0]?.v || '',
      answer: r.c[1]?.v || ''
    })).filter(q => q.question && q.answer);

    // Set initial counter
    document.getElementById('counter').textContent =
      `Questions remaining: ${allData.length} of ${allData.length}`;

  } catch (e) {
    alert("Failed to load Google Sheet");
    console.error(e);
  }
}

function generateQA() {
  if (allData.length === 0) {
    alert("Data not yet loaded.");
    return;
  }

  if (usedIndices.size >= allData.length) {
    alert("All questions used! Resetting...");
    usedIndices.clear();
  }

  let index;
  do {
    index = Math.floor(Math.random() * allData.length);
  } while (usedIndices.has(index));
  usedIndices.add(index);

  const item = allData[index];
  document.getElementById('question').textContent = item.question;
  document.getElementById('answer').textContent = item.answer;
  document.getElementById('answer').style.display = 'none';

  // Update counter
  document.getElementById('counter').textContent =
    `Questions remaining: ${allData.length - usedIndices.size} of ${allData.length}`;

  startTimer(12 * 60);
}

function toggleAnswer() {
  const answer = document.getElementById('answer');
  answer.style.display = (answer.style.display === 'none') ? 'block' : 'none';
}

function startTimer(seconds) {
  clearInterval(timerInterval);
  const timer = document.getElementById('timer');
  let remaining = seconds;

  function update() {
    const m = String(Math.floor(remaining / 60)).padStart(2, '0');
    const s = String(remaining % 60).padStart(2, '0');
    timer.textContent = `⏳ ${m}:${s}`;
    if (remaining <= 0) clearInterval(timerInterval);
    remaining--;
  }

  update();
  timerInterval = setInterval(update, 1000);
}

window.onload = fetchSheetData;
</script>

</body>
</html>
